<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Repo Browser – afrank84/DevOps-AutomationToolingV2</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0f1115;--panel:#161a22;--muted:#8ea1b3;--text:#e6ebf1;--border:#232938}
  *{box-sizing:border-box}
  body{margin:0;display:flex;height:100vh;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial}
  #sidebar{width:320px;min-width:260px;border-right:1px solid var(--border);display:flex;flex-direction:column}
  #header{padding:10px;background:var(--panel);border-bottom:1px solid var(--border);font-weight:600}
  #tree{flex:1;overflow:auto;padding:10px}
  ul{list-style:none;margin:0;padding-left:16px}
  li{margin:2px 0}
  .label{display:flex;gap:6px;align-items:center;padding:4px 6px;border-radius:6px;cursor:pointer}
  .label:hover{background:#0b0e13}
  .folder>.label .chev{width:0;height:0;border-left:5px solid var(--muted);border-top:4px solid transparent;border-bottom:4px solid transparent;transition:transform .15s}
  .folder.open>.label .chev{transform:rotate(90deg)}
  .name{word-break:break-all}
  #content{flex:1;overflow:auto;padding:12px}
  iframe{width:100%;height:calc(100vh - 24px);border:none;background:white}
  pre{background:#0b0e13;border:1px solid var(--border);padding:12px;border-radius:10px;overflow:auto}
  .tiny{font-size:.85rem;color:var(--muted)}
</style>
</head>
<body>
  <aside id="sidebar">
    <div id="header">DevOps-AutomationToolingV2</div>
    <div id="tree" class="tiny">Loading repository…</div>
  </aside>
  <main id="content">
    <h2>Select a file</h2>
    <p class="tiny">.html files render in the preview. Others show as text.</p>
  </main>

<script>
const REPO = 'afrank84/DevOps-AutomationToolingV2';
const BRANCH = 'main';

const treeEl = document.getElementById('tree');
const contentEl = document.getElementById('content');

function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
function escapeAttr(s){return s.replace(/&/g,'&amp;').replace(/"/g,'&quot;')}

async function fetchDir(path){
  const url = `https://api.github.com/repos/${REPO}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(BRANCH)}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error(`GitHub API ${res.status}`);
  return res.json();
}

function makeFolderLi(name, fullPath){
  const li = document.createElement('li');
  li.className = 'folder';
  const label = document.createElement('div');
  label.className = 'label';
  const chev = document.createElement('span'); chev.className = 'chev';
  const nm = document.createElement('span'); nm.className = 'name'; nm.textContent = name;
  label.append(chev, nm); li.append(label);
  const sub = document.createElement('ul'); sub.style.display='none'; li.append(sub);
  let loaded = false;

  label.addEventListener('click', async ()=>{
    const open = li.classList.toggle('open');
    sub.style.display = open ? 'block' : 'none';
    if(open && !loaded){
      try{
        const items = await fetchDir(fullPath);
        items.sort((a,b)=> (a.type!==b.type) ? (a.type==='dir'?-1:1) : a.name.localeCompare(b.name));
        for(const it of items){
          if(it.type==='dir'){
            sub.appendChild(makeFolderLi(it.name, it.path));
          }else if(it.type==='file'){
            sub.appendChild(makeFileLi(it.name, it.path));
          }
        }
        loaded = true;
      }catch(e){
        sub.innerHTML = `<li class="tiny">Failed to load: ${escapeHtml(String(e))}</li>`;
      }
    }
  });
  return li;
}

function makeFileLi(name, fullPath){
  const li = document.createElement('li');
  const label = document.createElement('div'); label.className = 'label';
  const nm = document.createElement('span'); nm.className = 'name'; nm.textContent = name;
  label.style.paddingLeft='14px'; label.append(nm); li.append(label);
  label.addEventListener('click', ()=> openFile(fullPath, name));
  return li;
}

async function openFile(path, name){
  const raw = `https://raw.githubusercontent.com/${REPO}/${BRANCH}/${path}`;
  contentEl.innerHTML = `<div class="tiny">Loading: ${escapeHtml(path)}</div>`;
  try{
    const res = await fetch(raw);
    if(!res.ok) throw new Error(`Raw ${res.status}`);
    const text = await res.text();
    if(name.toLowerCase().endsWith('.html')){
      contentEl.innerHTML = `<iframe sandbox="allow-scripts allow-forms allow-popups allow-modals allow-top-navigation-by-user-activation" srcdoc="${escapeAttr(text)}"></iframe>`;
    }else{
      contentEl.innerHTML = `<pre><code>${escapeHtml(text)}</code></pre>`;
    }
  }catch(err){
    contentEl.innerHTML = `<div class="tiny">Failed to load ${escapeHtml(path)}: ${escapeHtml(String(err))}</div>`;
  }
}

(async function init(){
  try{
    const rootUl = document.createElement('ul');
    treeEl.textContent = '';
    treeEl.append(rootUl);

    const items = await fetchDir(''); // repo root
    items.sort((a,b)=> (a.type!==b.type) ? (a.type==='dir'?-1:1) : a.name.localeCompare(b.name));

    for(const it of items){
      if(it.type==='dir'){
        rootUl.appendChild(makeFolderLi(it.name, it.path));
      }else if(it.type==='file'){
        rootUl.appendChild(makeFileLi(it.name, it.path));
      }
    }
  }catch(e){
    treeEl.textContent = 'Error loading repo: ' + e.message;
  }
})();
</script>
</body>
</html>
